<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Deep Text Analyzer - å¤šè§’çš„æ–‡ç« åˆ†æAI (2026 Pro)</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Inter', sans-serif; }
        .prose h3 { margin-top: 1.5em; margin-bottom: 0.5em; font-weight: 700; color: #1f2937; border-bottom: 2px solid #e5e7eb; padding-bottom: 0.2em; }
        .prose h4 { margin-top: 1.2em; margin-bottom: 0.5em; font-weight: 600; color: #374151; }
        .prose ul { list-style-type: disc; padding-left: 1.5em; margin-bottom: 1em; }
        .prose li { margin-bottom: 0.5em; }
        .prose strong { color: #2563eb; }
        .prose blockquote { border-left: 4px solid #3b82f6; background-color: #eff6ff; padding: 0.5em 1em; color: #1e40af; font-style: italic; margin: 1em 0; border-radius: 0 4px 4px 0; }
        .loader {
            border: 4px solid #f3f3f3;
            border-top: 4px solid #3b82f6;
            border-radius: 50%;
            width: 24px;
            height: 24px;
            animation: spin 1s linear infinite;
        }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
    </style>
</head>
<body class="bg-gray-50 text-gray-800 min-h-screen flex flex-col">

    <!-- ãƒ˜ãƒƒãƒ€ãƒ¼ -->
    <header class="bg-white shadow-sm sticky top-0 z-10">
        <div class="max-w-5xl mx-auto px-4 py-4 flex justify-between items-center">
            <div class="flex items-center gap-2">
                <span class="text-2xl">ğŸ§ </span>
                <h1 class="text-xl font-bold text-gray-900">Deep Text Analyzer <span class="text-xs bg-blue-100 text-blue-800 px-2 py-0.5 rounded-full ml-2">2026 Pro</span></h1>
            </div>
            <a href="https://github.com/" target="_blank" class="text-sm text-gray-500 hover:text-gray-900">GitHubã§å…¬é–‹ä¸­</a>
        </div>
    </header>

    <!-- ã‚¬ã‚¤ãƒ‰ã‚»ã‚¯ã‚·ãƒ§ãƒ³ -->
    <section class="max-w-5xl mx-auto px-4 mt-8">
        <div class="bg-white rounded-xl shadow-sm border border-blue-200 overflow-hidden">
            <div class="bg-blue-50 px-6 py-4 border-b border-blue-100 flex items-center gap-2">
                <span class="text-xl">â„¹ï¸</span>
                <h2 class="font-bold text-gray-800">ã¯ã˜ã‚ã«ï¼šã“ã®ãƒ„ãƒ¼ãƒ«ã«ã¤ã„ã¦</h2>
            </div>
            <div class="p-6 text-sm text-gray-600 space-y-4 leading-relaxed">
                <p>
                    Deep Text Analyzerã¯ã€<strong>è«–ç†å­¦ã€èªçŸ¥ç§‘å­¦ã€æ­´å²å­¦ã€ç§‘å­¦çš„æ¤œè¨¼</strong>ãªã©ã€å¤šæ§˜ãªã‚¢ã‚«ãƒ‡ãƒŸãƒƒã‚¯ãªè¦–ç‚¹ã‚’ã€Œãƒ¬ãƒ³ã‚ºã€ã¨ã—ã¦é©ç”¨ã—ã€æ–‡ç« ã®æ·±å±¤åˆ†æã‚’è¡Œã„ã¾ã™ã€‚
                    <br>
                    <span class="text-blue-600 font-bold">NEW:</span> å›³è¡¨ã‚„ã‚°ãƒ©ãƒ•ã®ç”»åƒã‚‚åŒæ™‚ã«ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ã™ã‚‹ã“ã¨ã§ã€ãƒ‡ãƒ¼ã‚¿ã¨æœ¬æ–‡ã®æ•´åˆæ€§ã‚‚åˆ†æå¯èƒ½ã«ãªã‚Šã¾ã—ãŸã€‚
                </p>
                
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mt-4 pt-4 border-t border-gray-100">
                    <div>
                        <h3 class="font-bold text-gray-800 mb-2 flex items-center gap-2">ğŸ”‘ APIã‚­ãƒ¼ã¨å®‰å…¨æ€§</h3>
                        <ul class="list-disc list-inside space-y-1 ml-1 text-gray-600">
                            <li>Googleã®AI <strong>Gemini</strong> ã‚’ä½¿ç”¨ã—ã¾ã™ã€‚</li>
                            <li>APIã‚­ãƒ¼ã¯ãƒ–ãƒ©ã‚¦ã‚¶å†…ã§ã®ã¿ä½¿ç”¨ã•ã‚Œã€å¤–éƒ¨ã‚µãƒ¼ãƒãƒ¼ã«ã¯é€ä¿¡ã•ã‚Œã¾ã›ã‚“ã€‚</li>
                        </ul>
                    </div>
                    <div>
                        <h3 class="font-bold text-gray-800 mb-2 flex items-center gap-2">ğŸ“‚ å‡ºåŠ›æ©Ÿèƒ½</h3>
                        <ul class="list-disc list-inside space-y-1 ml-1 text-gray-600">
                            <li>Text, Markdown, HTMLå½¢å¼ã§ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰å¯èƒ½ã€‚</li>
                            <li>ç”»åƒã‚’å«ã‚ãŸåˆ†æçµæœã‚‚ãƒ¬ãƒãƒ¼ãƒˆã«å‡ºåŠ›ã•ã‚Œã¾ã™ã€‚</li>
                        </ul>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- ãƒ¡ã‚¤ãƒ³ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ -->
    <main class="flex-grow max-w-5xl mx-auto px-4 py-8 w-full grid grid-cols-1 md:grid-cols-3 gap-8">
        
        <!-- å·¦ã‚«ãƒ©ãƒ ï¼šè¨­å®š -->
        <div class="md:col-span-1 space-y-6">
            
            <!-- APIã‚­ãƒ¼è¨­å®š -->
            <div class="bg-white p-5 rounded-xl shadow-sm border border-gray-100">
                <label class="block text-sm font-semibold text-gray-700 mb-2">Gemini API Key</label>
                <input type="password" id="apiKey" placeholder="AIzaSy..." class="w-full p-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:outline-none text-sm">
                <p class="text-xs text-gray-500 mt-2">
                    <a href="https://aistudio.google.com/app/apikey" target="_blank" class="text-blue-600 hover:underline flex items-center gap-1">
                        Google AI Studioã§ã‚­ãƒ¼ã‚’å–å¾— <svg class="w-3 h-3" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 6H6a2 2 0 00-2 2v10a2 2 0 002 2h10a2 2 0 002-2v-4M14 4h6m0 0v6m0-6L10 14"></path></svg>
                    </a>
                </p>
            </div>

            <!-- ãƒ¢ãƒ‡ãƒ«é¸æŠ -->
            <div class="bg-white p-5 rounded-xl shadow-sm border border-gray-100">
                <label class="block text-sm font-semibold text-gray-700 mb-2">ä½¿ç”¨ãƒ¢ãƒ‡ãƒ« (Gemini)</label>
                <select id="modelSelect" class="w-full p-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:outline-none text-sm bg-white">
                    <option value="gemini-2.5-flash" selected>Gemini 2.5 Flash (æ¨™æº–ãƒ»æ¨å¥¨)</option>
                    <option value="gemini-3.0-flash-preview">Gemini 3.0 Flash Preview (é«˜é€Ÿãƒ»æœ€æ–°)</option>
                    <option value="gemini-3.0-pro-preview">Gemini 3.0 Pro Preview (æœ€é«˜ç²¾åº¦)</option>
                </select>
            </div>

            <!-- åˆ†æãƒœã‚¿ãƒ³ -->
            <button id="analyzeBtn" class="w-full bg-blue-600 hover:bg-blue-700 text-white font-bold py-3 px-4 rounded-xl shadow-md transition duration-200 flex justify-center items-center gap-2">
                <span>åˆ†æã‚’å®Ÿè¡Œã™ã‚‹</span>
                <div id="loadingSpinner" class="loader hidden"></div>
            </button>

            <!-- ãƒªã‚»ãƒƒãƒˆãƒœã‚¿ãƒ³ -->
            <button id="resetBtn" class="w-full bg-gray-200 hover:bg-gray-300 text-gray-700 font-semibold py-2 px-4 rounded-lg transition duration-200 text-sm">
                çµæœã‚’ãƒªã‚»ãƒƒãƒˆ
            </button>
        </div>

        <!-- å³ã‚«ãƒ©ãƒ ï¼šå…¥åŠ›ã¨çµæœ -->
        <div class="md:col-span-2 space-y-6">
            
            <!-- æ³¨æ„æ›¸ã -->
            <div class="bg-yellow-50 border-l-4 border-yellow-400 p-4 rounded-r shadow-sm">
                <div class="flex">
                    <div class="flex-shrink-0">
                        <svg class="h-5 w-5 text-yellow-400" viewBox="0 0 20 20" fill="currentColor">
                            <path fill-rule="evenodd" d="M8.257 3.099c.765-1.36 2.722-1.36 3.486 0l5.58 9.92c.75 1.334-.213 2.98-1.742 2.98H4.42c-1.53 0-2.493-1.646-1.743-2.98l5.58-9.92zM11 13a1 1 0 11-2 0 1 1 0 012 0zm-1-8a1 1 0 00-1 1v3a1 1 0 002 0V6a1 1 0 00-1-1z" clip-rule="evenodd" />
                        </svg>
                    </div>
                    <div class="ml-3">
                        <p class="text-sm text-yellow-700">
                            <strong>âš ï¸ æœ€æ–°æƒ…å ±ã«é–¢ã™ã‚‹æ³¨æ„:</strong><br>
                            AIã®çŸ¥è­˜ã¯å­¦ç¿’ãƒ‡ãƒ¼ã‚¿ã«åŸºã¥ã„ã¦ã„ã¾ã™ã€‚ç›´è¿‘ã®ãƒ‹ãƒ¥ãƒ¼ã‚¹ç­‰ã«ã¤ã„ã¦ã¯æ­£ç¢ºãªæƒ…å ±ã‚’æŒã£ã¦ã„ãªã„å¯èƒ½æ€§ãŒã‚ã‚Šã¾ã™ã€‚
                        </p>
                    </div>
                </div>
            </div>

            <!-- ãƒ†ã‚­ã‚¹ãƒˆå…¥åŠ›ã‚¨ãƒªã‚¢ -->
            <div class="bg-white p-1 rounded-xl shadow-sm border border-gray-100">
                <textarea id="inputText" rows="6" class="w-full p-4 rounded-lg focus:outline-none resize-y text-gray-700" placeholder="ã“ã“ã«åˆ†æã—ãŸã„æ–‡ç« ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„...&#10;(ä¾‹: ãƒ‹ãƒ¥ãƒ¼ã‚¹è¨˜äº‹ã€åºƒå‘Šæ–‡ã€è¬ç½ªæ–‡ã€SNSã®æŠ•ç¨¿ãªã©)"></textarea>
                
                <!-- ç”»åƒã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ã‚¨ãƒªã‚¢ (æ–°è¦è¿½åŠ ) -->
                <div class="border-t border-gray-100 p-3 bg-gray-50 rounded-b-lg flex items-center gap-4">
                    <label class="cursor-pointer flex items-center gap-2 text-sm text-gray-600 hover:text-blue-600 transition">
                        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z"></path></svg>
                        <span class="font-semibold">å›³è¡¨ãƒ»ç”»åƒã‚’è¿½åŠ  (ä»»æ„)</span>
                        <input type="file" id="imageInput" accept="image/*" class="hidden">
                    </label>
                    <div id="imagePreviewName" class="text-xs text-gray-500 truncate max-w-[200px]"></div>
                    <button id="clearImageBtn" class="hidden text-xs text-red-500 hover:underline">å‰Šé™¤</button>
                </div>
                <!-- ç”»åƒãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼è¡¨ç¤º -->
                <div id="imagePreviewContainer" class="hidden p-4 bg-gray-50 border-t border-gray-200">
                    <img id="imagePreview" src="" alt="Preview" class="max-h-48 rounded shadow-sm border border-gray-300">
                </div>
            </div>

            <!-- çµæœè¡¨ç¤ºã‚¨ãƒªã‚¢ -->
            <div id="resultContainer" class="hidden">
                <div class="flex justify-between items-center mb-2">
                    <h2 class="text-lg font-bold text-gray-800">ğŸ“Š åˆ†æãƒ¬ãƒãƒ¼ãƒˆ</h2>
                    <div class="flex gap-2">
                        <button onclick="exportReport('txt')" class="text-xs bg-white border border-gray-300 hover:bg-gray-50 px-3 py-1 rounded shadow-sm flex items-center gap-1">ğŸ“„ TXT</button>
                        <button onclick="exportReport('md')" class="text-xs bg-white border border-gray-300 hover:bg-gray-50 px-3 py-1 rounded shadow-sm flex items-center gap-1">ğŸ“ MD</button>
                        <button onclick="exportReport('html')" class="text-xs bg-white border border-gray-300 hover:bg-gray-50 px-3 py-1 rounded shadow-sm flex items-center gap-1">ğŸŒ HTML</button>
                    </div>
                </div>
                <div id="outputContent" class="bg-white p-6 rounded-xl shadow-md border border-gray-200 prose max-w-none text-sm leading-relaxed"></div>
            </div>

        </div>
    </main>

    <!-- ãƒ•ãƒƒã‚¿ãƒ¼ -->
    <footer class="bg-gray-100 py-6 mt-auto">
        <div class="max-w-5xl mx-auto px-4 text-center text-gray-500 text-xs">
            <p>&copy; 2026 Deep Text Analyzer. Powered by Google Gemini API (v2.5/v3.0).</p>
        </div>
    </footer>

    <script>
        // --- ã‚·ã‚¹ãƒ†ãƒ ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆ (ç”»åƒåˆ†æå¯¾å¿œç‰ˆ) ---
        const SYSTEM_PROMPT = `
ã‚ãªãŸã¯ã€èªçŸ¥ç§‘å­¦ã€å“²å­¦ã€è«–ç†å­¦ã€ç¤¾ä¼šå­¦ã€æ­´å²å­¦ã€ç§‘å­¦å“²å­¦ã«ç²¾é€šã—ãŸæœ€é«˜ãƒ¬ãƒ™ãƒ«ã®ãƒ†ã‚­ã‚¹ãƒˆåˆ†æå®˜ã§ã™ã€‚
ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‹ã‚‰å…¥åŠ›ã•ã‚ŒãŸæ–‡ç« ï¼ˆãŠã‚ˆã³æ·»ä»˜ã•ã‚ŒãŸå›³è¡¨ï¼‰ã«å¯¾ã—ã€ä»¥ä¸‹ã®ãƒ—ãƒ­ã‚»ã‚¹ã‚’çµŒã¦æ·±å±¤åˆ†æã‚’è¡Œã£ã¦ãã ã•ã„ã€‚

# åˆ†æãƒ—ãƒ­ã‚»ã‚¹

## Step 1: å¤§ã‚«ãƒ†ã‚´ãƒªã®åˆ¤å®š
æ–‡ç« ã‚’ä»¥ä¸‹ã®4ã¤ã‹ã‚‰åˆ†é¡ã—ã¦ãã ã•ã„ã€‚
[ A. èª¬å¾—ãƒ»ã‚ªãƒ”ãƒ‹ã‚ªãƒ³ / B. ãƒ“ã‚¸ãƒã‚¹ãƒ»åºƒå ± / C. æƒ…å ±ãƒ»çŸ¥è­˜ / D. ç‰©èªãƒ»å€‹äºº ]

## Step 2: è©³ç´°ã‚¸ãƒ£ãƒ³ãƒ«ï¼ˆã‚µãƒ–ã‚«ãƒ†ã‚´ãƒªï¼‰ã®ç‰¹å®š
*   **Aç³»:** [A-1. æ‰‡å‹•ãƒ»æ¥µè«–], [A-2. å»ºè¨­çš„è­°è«–], [A-3. çš®è‚‰ãƒ»é¢¨åˆº]
*   **Bç³»:** [B-1. ã‚»ãƒ¼ãƒ«ã‚¹ãƒ»åºƒå‘Š], [B-2. è¬ç½ªãƒ»å±æ©Ÿç®¡ç†], [B-3. ãƒ“ã‚¸ãƒ§ãƒ³ãƒ»æ–¹é‡]
*   **Cç³»:** [C-1. ãƒ‹ãƒ¥ãƒ¼ã‚¹ãƒ»å ±é“], [C-2. è§£èª¬ãƒ»æ•™è‚²], [C-3. é™°è¬€è«–ãƒ»éƒ½å¸‚ä¼èª¬]
*   **Dç³»:** [D-1. ã‚¨ãƒƒã‚»ã‚¤ãƒ»ä½“é¨“è«‡], [D-2. å‰µä½œãƒ»ãƒ•ã‚£ã‚¯ã‚·ãƒ§ãƒ³]

## Step 3: æœ€é©ãªåˆ†æãƒ¬ãƒ³ã‚ºã®è£…ç€
ä»¥ä¸‹ã®ã€ãƒ¬ãƒ³ã‚ºãƒªã‚¹ãƒˆã€‘ã‹ã‚‰**æœ€ã‚‚é‹­ã„æ´å¯Ÿã‚’ä¸ãˆã‚‹3ã€œ4ã¤ã®è¦–ç‚¹**ã‚’é¸å®šã—ã¦ãã ã•ã„ã€‚
**â€»é‡è¦: ç”»åƒï¼ˆå›³è¡¨ãƒ»ã‚°ãƒ©ãƒ•ï¼‰ãŒæ·»ä»˜ã•ã‚Œã¦ã„ã‚‹å ´åˆã¯ã€å¿…ãšã€Œ13. å›³è¡¨ãƒ»ãƒ‡ãƒ¼ã‚¿æ•´åˆæ€§ã€ã‚’å„ªå…ˆçš„ã«é©ç”¨ã—ã¦ãã ã•ã„ã€‚**

**ã€ãƒ¬ãƒ³ã‚ºãƒªã‚¹ãƒˆã€‘**
1.  **èªçŸ¥ãƒ¢ãƒ¼ãƒ‰ (System 1 & 2):** ç›´æ„Ÿ(Sys1)ãƒãƒƒã‚¯ã‹ã€ç†Ÿæ…®(Sys2)ã‹ã€‚
2.  **ç’°ä¸–ç•Œ (Umwelt):** èªè­˜ã®ãƒãƒ–ãƒ«ã€ä»–è€…ã¸ã®æƒ³åƒåŠ›ã€‚
3.  **æ™®éçš„ç†æ€§ (Universal Reason):** æ™®éæ€§ã€è„±ã‚¨ã‚´ã‚¤ã‚ºãƒ ã€‚
4.  **æ¨©åŠ›ã¨æ§‹é€  (Power & Structure):** æ”¯é…æ§‹é€ ã€ãƒã‚¸ã‚·ãƒ§ãƒ³ãƒˆãƒ¼ã‚¯ã€‚
5.  **ãƒŠãƒ©ãƒ†ã‚£ãƒ–ã¨å…ƒå‹:** ç‰©èªæ§‹é€ ï¼ˆãƒ’ãƒ¼ãƒ­ãƒ¼/ãƒ´ã‚£ãƒ©ãƒ³ï¼‰ã€‚
6.  **ãƒ•ãƒ¬ãƒ¼ãƒŸãƒ³ã‚°:** å°è±¡æ“ä½œã€åˆ‡ã‚Šå–ã‚Šã€‚
7.  **ãƒŸãƒ¼ãƒ ãƒ»æ„ŸæŸ“åŠ›:** æ‹¡æ•£æ€§ã€å˜ç´”åŒ–ã€‚
8.  **è«–ç†çš„æ•´åˆæ€§:** çŸ›ç›¾ã€èª¤è¬¬ã€‚
9.  **ç§‘å­¦çš„ä¿¡æ†‘æ€§:** ç§‘å­¦çš„ã‚³ãƒ³ã‚»ãƒ³ã‚µã‚¹ã€ã‚¨ãƒ“ãƒ‡ãƒ³ã‚¹ã®è³ªã€‚
10. **æ­´å²çš„ä¿¡æ†‘æ€§:** å²å®Ÿã¨ã®æ•´åˆæ€§ã€æ™‚ä»£éŒ¯èª¤ã€‚
11. **å€«ç†ãƒ»å…¬å¹³æ€§:** å·®åˆ¥ã€åè¦‹ã€‚
12. **å®Ÿç”¨æ€§ãƒ»å®Ÿè¡Œå¯èƒ½æ€§:** ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ãƒ—ãƒ©ãƒ³ã€‚
13. **å›³è¡¨ãƒ»ãƒ‡ãƒ¼ã‚¿æ•´åˆæ€§ (Visual Data Consistency):** æœ¬æ–‡ã®ä¸»å¼µã¨ã€æ·»ä»˜ã•ã‚ŒãŸå›³è¡¨ãƒ»ã‚°ãƒ©ãƒ•ã®ãƒ‡ãƒ¼ã‚¿ãŒä¸€è‡´ã—ã¦ã„ã‚‹ã‹ã€‚ã‚°ãƒ©ãƒ•ã®è»¸æ“ä½œã‚„è¦–è¦šçš„ãƒˆãƒªãƒƒã‚¯ï¼ˆãƒã‚§ãƒªãƒ¼ãƒ”ãƒƒã‚­ãƒ³ã‚°ï¼‰ãŒãªã„ã‹ã€‚

---

# å‡ºåŠ›ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆï¼ˆMarkdownå½¢å¼ï¼‰

## ğŸ“Š æ–‡ç« ã‚¿ã‚¤ãƒ—åˆ¤å®š
*   **å¤§ã‚«ãƒ†ã‚´ãƒª:** [Step1ã®çµæœ]
*   **è©³ç´°ã‚¸ãƒ£ãƒ³ãƒ«:** [Step2ã®çµæœ]

## ğŸ§  é©ç”¨ã—ãŸåˆ†æãƒ¬ãƒ³ã‚º
1. **[è¦–ç‚¹å]**: [é¸å®šç†ç”±]
2. **[è¦–ç‚¹å]**: [é¸å®šç†ç”±]
3. **[è¦–ç‚¹å]**: [é¸å®šç†ç”±]

## ğŸ“ æ·±å±¤åˆ†æãƒ¬ãƒãƒ¼ãƒˆ

### 1. [è¦–ç‚¹å] ã«ã‚ˆã‚‹åˆ†æ
*   **æ´å¯Ÿ:** [åˆ†æå†…å®¹]
*   **å¼•ç”¨:** "[è©²å½“ç®‡æ‰€]" (ç”»åƒã®å ´åˆã¯ã€Œæ·»ä»˜å›³è¡¨ã€ã¨è¨˜è¿°)

ï¼ˆä»¥ä¸‹ã€é¸å®šã—ãŸè¦–ç‚¹åˆ†ç¹°ã‚Šè¿”ã™ï¼‰

---
## ğŸ’¡ ç·åˆè€ƒå¯Ÿ
ï¼ˆæ–‡ç« ã®ä¿¡é ¼æ€§ã€çŸ¥æ€§ã€å±é™ºæ€§ãªã©ã‚’ç·åˆçš„ã«è©•ä¾¡ã—ã€Sã€œDãƒ©ãƒ³ã‚¯ã§åˆ¤å®šï¼‰
â€»æ³¨æ„: æœ€æ–°ã®ãƒ‹ãƒ¥ãƒ¼ã‚¹ç­‰ã«é–¢ã—ã¦ã¯ã€å­¦ç¿’ãƒ‡ãƒ¼ã‚¿ã®ã‚¿ã‚¤ãƒ ãƒ©ã‚°ã«ã‚ˆã‚Šæ­£ç¢ºãªåˆ¤å®šãŒã§ããªã„å¯èƒ½æ€§ãŒã‚ã‚Šã¾ã™ã€‚
`;

        // --- å¤‰æ•° ---
        let rawMarkdown = "";
        let selectedImageBase64 = null;
        let selectedImageMimeType = null;

        // --- DOMè¦ç´  ---
        const apiKeyInput = document.getElementById('apiKey');
        const modelSelect = document.getElementById('modelSelect');
        const inputText = document.getElementById('inputText');
        const imageInput = document.getElementById('imageInput');
        const imagePreviewName = document.getElementById('imagePreviewName');
        const imagePreviewContainer = document.getElementById('imagePreviewContainer');
        const imagePreview = document.getElementById('imagePreview');
        const clearImageBtn = document.getElementById('clearImageBtn');
        const analyzeBtn = document.getElementById('analyzeBtn');
        const resetBtn = document.getElementById('resetBtn');
        const resultContainer = document.getElementById('resultContainer');
        const outputContent = document.getElementById('outputContent');
        const loadingSpinner = document.getElementById('loadingSpinner');

        // --- ã‚¤ãƒ™ãƒ³ãƒˆãƒªã‚¹ãƒŠãƒ¼ ---
        
        // ç”»åƒé¸æŠæ™‚
        imageInput.addEventListener('change', (e) => {
            const file = e.target.files[0];
            if (!file) return;

            const reader = new FileReader();
            reader.onload = (event) => {
                // ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼è¡¨ç¤º
                imagePreview.src = event.target.result;
                imagePreviewContainer.classList.remove('hidden');
                imagePreviewName.textContent = file.name;
                clearImageBtn.classList.remove('hidden');

                // APIé€ä¿¡ç”¨ãƒ‡ãƒ¼ã‚¿æº–å‚™ (Base64ã®ãƒ˜ãƒƒãƒ€ãƒ¼é™¤å»)
                selectedImageBase64 = event.target.result.split(',')[1];
                selectedImageMimeType = file.type;
            };
            reader.readAsDataURL(file);
        });

        // ç”»åƒå‰Šé™¤ãƒœã‚¿ãƒ³
        clearImageBtn.addEventListener('click', () => {
            imageInput.value = '';
            selectedImageBase64 = null;
            selectedImageMimeType = null;
            imagePreviewContainer.classList.add('hidden');
            imagePreviewName.textContent = '';
            clearImageBtn.classList.add('hidden');
        });

        // åˆ†æãƒœã‚¿ãƒ³
        analyzeBtn.addEventListener('click', async () => {
            const apiKey = apiKeyInput.value.trim();
            const text = inputText.value.trim();
            const model = modelSelect.value;

            if (!apiKey) { alert('APIã‚­ãƒ¼ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„ã€‚'); return; }
            if (!text && !selectedImageBase64) { alert('åˆ†æã™ã‚‹æ–‡ç« ã¾ãŸã¯ç”»åƒã‚’å…¥åŠ›ã—ã¦ãã ã•ã„ã€‚'); return; }

            setLoading(true);
            resultContainer.classList.add('hidden');

            try {
                const result = await callGeminiAPI(apiKey, model, text, selectedImageBase64, selectedImageMimeType);
                rawMarkdown = result;
                outputContent.innerHTML = marked.parse(result);
                resultContainer.classList.remove('hidden');
                resultContainer.scrollIntoView({ behavior: 'smooth' });
            } catch (error) {
                console.error(error);
                alert('ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ: ' + error.message);
            } finally {
                setLoading(false);
            }
        });

        // ãƒªã‚»ãƒƒãƒˆãƒœã‚¿ãƒ³
        resetBtn.addEventListener('click', () => {
            if(confirm('å…¥åŠ›å†…å®¹ã¨åˆ†æçµæœã‚’ã‚¯ãƒªã‚¢ã—ã¾ã™ã‹ï¼Ÿ')) {
                inputText.value = '';
                clearImageBtn.click(); // ç”»åƒã‚‚ã‚¯ãƒªã‚¢
                outputContent.innerHTML = '';
                resultContainer.classList.add('hidden');
                rawMarkdown = "";
            }
        });

        // --- é–¢æ•° ---
        function setLoading(isLoading) {
            if (isLoading) {
                analyzeBtn.disabled = true;
                analyzeBtn.classList.add('opacity-75', 'cursor-not-allowed');
                loadingSpinner.classList.remove('hidden');
            } else {
                analyzeBtn.disabled = false;
                analyzeBtn.classList.remove('opacity-75', 'cursor-not-allowed');
                loadingSpinner.classList.add('hidden');
            }
        }

        async function callGeminiAPI(key, model, userText, imageBase64, mimeType) {
            const url = `https://generativelanguage.googleapis.com/v1beta/models/${model}:generateContent?key=${key}`;
            
            // ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ãƒ‘ãƒ¼ãƒ„ã®æ§‹ç¯‰
            const parts = [];
            parts.push({ text: SYSTEM_PROMPT });
            
            // ç”»åƒãŒã‚ã‚‹å ´åˆ
            if (imageBase64) {
                parts.push({
                    inline_data: {
                        mime_type: mimeType,
                        data: imageBase64
                    }
                });
                parts.push({ text: "\n\n(â€»ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒç”»åƒã‚’æ·»ä»˜ã—ã¾ã—ãŸã€‚å›³è¡¨ã‚„ã‚°ãƒ©ãƒ•ãŒå«ã¾ã‚Œã¦ã„ã‚‹å ´åˆã¯ã€ãã®ãƒ‡ãƒ¼ã‚¿ã¨æœ¬æ–‡ã®æ•´åˆæ€§ã‚‚åˆ†æã—ã¦ãã ã•ã„)" });
            }

            parts.push({ text: `\n\n# å…¥åŠ›æ–‡ç« \n${userText}` });

            const payload = {
                contents: [{ role: "user", parts: parts }],
                generationConfig: { temperature: 0.7, topK: 40, topP: 0.95, maxOutputTokens: 8192 }
            };

            const response = await fetch(url, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify(payload)
            });

            if (!response.ok) {
                const errorData = await response.json();
                let errorMessage = errorData.error?.message || 'API request failed';
                if (errorMessage.includes('404')) errorMessage += `\n(ãƒ¢ãƒ‡ãƒ« ${model} ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“)`;
                throw new Error(errorMessage);
            }
            const data = await response.json();
            return data.candidates[0].content.parts[0].text;
        }

        function exportReport(type) {
            if (!rawMarkdown) return;
            let content = "", mimeType = "", extension = "";
            const timestamp = new Date().toISOString().replace(/[:.]/g, '-').slice(0, 19);
            const filename = `analysis_report_${timestamp}`;

            if (type === 'txt') {
                content = document.getElementById('outputContent').innerText;
                mimeType = 'text/plain'; extension = 'txt';
            } else if (type === 'md') {
                content = rawMarkdown;
                mimeType = 'text/markdown'; extension = 'md';
            } else if (type === 'html') {
                content = `<!DOCTYPE html><html lang="ja"><head><meta charset="UTF-8"><title>åˆ†æãƒ¬ãƒãƒ¼ãƒˆ</title><style>body{font-family:sans-serif;max-width:800px;margin:2rem auto;padding:0 1rem;line-height:1.6;color:#333;}blockquote{border-left:4px solid #ccc;padding-left:1em;color:#666;}</style></head><body>${marked.parse(rawMarkdown)}</body></html>`;
                mimeType = 'text/html'; extension = 'html';
            }

            const blob = new Blob([content], { type: mimeType });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url; a.download = `${filename}.${extension}`;
            document.body.appendChild(a); a.click();
            document.body.removeChild(a); URL.revokeObjectURL(url);
        }
    </script>
</body>
</html>
